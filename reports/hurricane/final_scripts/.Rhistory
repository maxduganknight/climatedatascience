era5 <- read.csv('../../data/UNSEEN/wildfire/cems/preprocessed/ERA5_monthly_max.csv')
era5$time <- ymd(era5$time)
era5$month <- month(era5$time)
era5$year <- year(era5$time)
library(extRemes)
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
library(cowplot)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
source('../../../UNSEEN-open-Deep-Sky/src/evt_plot.r')
# Load data
era5 <- read.csv('../../data/UNSEEN/wildfire/cems/preprocessed/ERA5_monthly_max.csv')
era5$time <- ymd(era5$time)
era5$month <- month(era5$time)
era5$year <- year(era5$time)
View(era5)
stationary_model <- fevd(era5$fwinx, type = "GEV")
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
summary(non_stationary_model)
earliest_year <- min(era5$year)
latest_year <- max(era5$year)
# Create covariate matrices for the given model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, sigma1 = earliest_year))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, sigma1 = latest_year))
GEV_type <- "GEV"
# Define a function to calculate return values and confidence intervals
RV_ci <- function(fit, qcov_start, qcov_end, return_periods) {
ci_start <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_start, method = 'normal')
ci_end <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_end, method = 'normal')
results <- data.frame(
Return_Period = return_periods,
Start_Lower = ci_start[, 1],
Start_Central = ci_start[, 2],
Start_Upper = ci_start[, 3],
End_Lower = ci_end[, 1],
End_Central = ci_end[, 2],
End_Upper = ci_end[, 3]
)
return(results)
}
return_periods <- c(2, 3, 5, 10, 25, 100)
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
return_levels_results
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year + I(era5$year^2), ,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year + I(era5$year^2), ,
location.fun = ~ era5$year,
use.phi = TRUE,
type = "GEV")
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year + I(era5$year^2), ,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
non_stationary_model
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year + I(era5$year^2) ,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
non_stationary_model
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year,
location.fun = ~ era5$year + I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
summary(non_stationary_model)
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year + I(era5$year^2) ,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
non_stationary_model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, sigma1 = earliest_year, sigma2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, sigma1 = latest_year, sigma2 = latest_year^2))
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
return_levels_results
era5 <- read.csv('../../data/UNSEEN/wildfire/cems/preprocessed/ERA5_yearly_max.csv')
era5 <- read.csv('../../data/UNSEEN/wildfire/cems/preprocessed/ERA5_yearly_max.csv')
era5$time <- ymd(era5$time)
era5$month <- month(era5$time)
era5$year <- year(era5$time)
stationary_model <- fevd(era5$fwinx, type = "GEV")
non_stationary_model <- fevd(era5$fwinx,
#scale.fun = ~era5$year + I(era5$year^2) ,
location.fun = ~ era5$year+ I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
earliest_year <- min(era5$year)
latest_year <- max(era5$year)
summary(non_stationary_model)
earliest_year <- min(era5$year)
latest_year <- max(era5$year)
# Create covariate matrices for the given model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, mu2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, mu2 = latest_year^2))
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year, # + I(era5$year^2) ,
location.fun = ~ era5$year+ I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
non_stationary_model
earliest_year <- min(era5$year)
latest_year <- max(era5$year)
# Create covariate matrices for the given model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, sigma1 = earliest_year, mu2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, sigma1 = latest_year, mu2 = latest_year^2))
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year, # + I(era5$year^2) ,
location.fun = ~ era5$year, #+ I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
earliest_year <- min(era5$year)
latest_year <- max(era5$year)
# Create covariate matrices for the given model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, sigma1 = earliest_year)) #, mu2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, sigma1 = latest_year)) #, mu2 = latest_year^2))
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
return_levels_results
RV_ci <- function(fit, qcov_start, qcov_end, return_periods) {
ci_start <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_start)
ci_end <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_end)
results <- data.frame(
Return_Period = return_periods,
Start_Central = ci_start[,2],
Start_Lower = ci_start[, 1],
Start_Upper = ci_start[, 3],
End_Central = ci_end[,2],
End_Lower = ci_end[, 1],
End_Upper = ci_end[, 3]
)
return(results)
}
return_periods <- c(2, 3, 5, 10, 25, 100)
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
return_levels_results
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year,#  + I(era5$year^2) ,
location.fun = ~ era5$year, + I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year,#  + I(era5$year^2) ,
location.fun = ~ era5$year + I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
earliest_year <- min(era5$year)
latest_year <- max(era5$year)
# Create covariate matrices for the given model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, sigma1 = earliest_year , mu2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, sigma1 = latest_year , mu2 = latest_year^2))
non_stationary_model
GEV_type <- "GEV"
# Define a function to calculate return values and confidence intervals
RV_ci <- function(fit, qcov_start, qcov_end, return_periods) {
ci_start <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_start)
ci_end <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_end)
results <- data.frame(
Return_Period = return_periods,
Start_Central = ci_start[,2],
Start_Lower = ci_start[, 1],
Start_Upper = ci_start[, 3],
End_Central = ci_end[,2],
End_Lower = ci_end[, 1],
End_Upper = ci_end[, 3]
)
return(results)
}
return_periods <- c(2, 3, 5, 10, 25, 100)
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year,+ I(era5$year^2) ,
location.fun = ~ era5$year, # + I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
non_stationary_model <- fevd(era5$fwinx,
scale.fun = ~era5$year+ I(era5$year^2) ,
location.fun = ~ era5$year, # + I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
non_stationary_model
# Create covariate matrices for the given model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year, sigma1 = earliest_year , sigma2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year, sigma1 = latest_year , sigma2 = latest_year^2))
GEV_type <- "GEV"
# Define a function to calculate return values and confidence intervals
RV_ci <- function(fit, qcov_start, qcov_end, return_periods) {
ci_start <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_start)
ci_end <- ci(fit, alpha = 0.05, type = 'return.level', return.period = return_periods, qcov = qcov_end)
results <- data.frame(
Return_Period = return_periods,
Start_Central = ci_start[,2],
Start_Lower = ci_start[, 1],
Start_Upper = ci_start[, 3],
End_Central = ci_end[,2],
End_Lower = ci_end[, 1],
End_Upper = ci_end[, 3]
)
return(results)
}
return_periods <- c(2, 3, 5, 10, 25, 100)
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
non_stationary_model <- fevd(era5$fwinx,
#scale.fun = ~era5$year+ I(era5$year^2) ,
location.fun = ~ era5$year + I(era5$year^2),
#use.phi = TRUE,
type = "GEV")
non_stationary_model
qcov_earliest <- make.qcov(non_stationary_model, vals = list(mu1 = earliest_year , mu2 = earliest_year^2))
qcov_latest <- make.qcov(non_stationary_model, vals = list(mu1 = latest_year , mu2 = latest_year^2))
return_levels_results <- RV_ci(non_stationary_model, qcov_earliest, qcov_latest, return_periods)
era5_monthly_max <- read.csv('../../data/UNSEEN/wildfire/cems/preprocessed/ERA5_monthly_max.csv')
era5_monthly_max$time <- as.Date(era5_monthly_max$time)
era5_monthly_max <- era5_monthly_max[order(era5_monthly_max$time), ]
severity_model <- fevd(x = era5_monthly_max$fwinx,
location.fun = ~ era5_yearly_max$year_index + I(era5_yearly_max$year_index^2),
#scale.fun = ~ era5_yearly_max$index + I(era5_yearly_max$index^2),
use.phi = TRUE,
type = "GEV")
library(ncdf4)
library(extRemes)
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
library(cowplot)
library(lubridate)
library(POT)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
era5 <- read.csv('../../../data/UNSEEN/hurricane/rainfall_preprocessed/ERA5_1d_monthly_max.csv')
era5$time <- ymd(era5$time)
era5$month <- month(era5$time)
era5$year <- year(era5$time)
era5 <- era5[!is.na(era5$tp), ]
# visualize original data
ggplot(era5, aes(x = year, y = tp)) +
geom_point() +
geom_smooth(method = "loess") +
ggtitle("Single-day Monthly Maximum Precipitation (m)")
stationary_model <- fevd(era5$tp, type = "GEV")
non_stationary_model <- fevd(era5$tp,
scale.fun = ~era5$year,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
non_stationary_model
non_stationary_model <- fevd(era5$tp,
scale.fun = ~era5$year,
location.fun = ~ era5$year,
use.phi = TRUE,
type = "GEV")
non_stationary_model <- fevd(era5$tp,
scale.fun = ~era5$year,
location.fun = ~ era5$year,
#use.phi = TRUE,
type = "GEV")
lr.test(stationary_model, non_stationary_model)
summary(non_stationary_model)
library(ncdf4)
library(extRemes)
library(ggplot2)
library(dplyr)
library(tidyr)
library(knitr)
library(cowplot)
library(lubridate)
library(POT)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
era5 <- read.csv('../../../data/UNSEEN/hurricane/rainfall_preprocessed/ERA5_1d_monthly_max.csv')
era5$time <- ymd(era5$time)
era5$month <- month(era5$time)
era5$year <- year(era5$time)
era5 <- era5[!is.na(era5$tp), ]
# visualize original data
ggplot(era5, aes(x = year, y = tp)) +
geom_point() +
geom_smooth(method = "loess") +
ggtitle("Single-day Monthly Maximum Precipitation (m)")
